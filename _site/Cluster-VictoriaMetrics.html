<!DOCTYPE html> <html lang="en" dir="auto"> <head><meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="Cluster version VictoriaMetrics is a fast, cost-effective and scalable time series database. It can be used as a long-term remote storage for Prome..."> <meta name="revised" content="156072bda364bc719a657b8c14a5f5ba4c757132"> <meta name="author" content="Brensted"> <meta name="generator" content="rundocs/jekyll-rtd-theme v2.0.10"><meta name="theme-color" content="#2980b9"> <title>Cluster version 路 VictoriaMetrics</title> <meta name="twitter:title" content="Cluster version 路 VictoriaMetrics"> <meta name="twitter:description" content="Cluster version VictoriaMetrics is a fast, cost-effective and scalable time series database. It can be used as a long-term remote storage for Prome..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@Brensted"> <meta name="twitter:url" content="http://localhost:4000/Cluster-VictoriaMetrics.html"> <meta name="twitter:creator" content="@rundocs/jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="Cluster version 路 VictoriaMetrics"> <meta property="og:description" content="Cluster version VictoriaMetrics is a fast, cost-effective and scalable time series database. It can be used as a long-term remote storage for Prome..."> <meta property="og:locale" content="en"> <meta property="og:url" content="http://localhost:4000/Cluster-VictoriaMetrics.html"> <meta property="og:type" content="article"> <meta property="article:author" content="Brensted"> <meta property="article:published_time" content="2021-02-25T10:08:59+02:00"> <meta property="article:modified_time" content="2021-02-25T10:28:47+02:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "http://localhost:4000/Cluster-VictoriaMetrics.html" }, "headline": "Cluster version 路 VictoriaMetrics", "image": [], "author": { "@type": "Person", "name": "Brensted" }, "datePublished": "2021-02-25T10:08:59+02:00", "dateModified": "2021-02-25T10:28:47+02:00", "publisher": { "@type": "User", "name": "Brensted", "logo": { "@type": "ImageObject", "url": "https://avatars.githubusercontent.com/u/75306281?v=4" } }, "description": "Cluster version VictoriaMetrics is a fast, cost-effective and scalable time series database. It can be used as a long-term remote storage for Prome..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="next" href="http://localhost:4000/ExtendedPromQL.html"><link rel="canonical" href="http://localhost:4000/Cluster-VictoriaMetrics.html"><link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg"><link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96"><link rel="mask-icon" href="/assets/images/favicon.svg" color="#2980b9"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css"><script> window.ui = { title: "VictoriaMetrics", baseurl: "", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container"><div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/" title="VictoriaMetrics"> <i class="fa fa-home"></i> VictoriaMetrics </a> </div> <span class="version"></span> <form class="search pt-2" action="/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> <li class="toc level-1 current" data-sort="" data-level="1"> <a class="d-flex flex-items-baseline current" href="/Cluster-VictoriaMetrics.html">Cluster version</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/ExtendedPromQL.html">MetricsQL</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Home.html">Docs</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Quick-Start.html">Quick Start</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Release-Guide.html">Release-Guide.md</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/SampleSizeCalculations.html">Sample size calculations</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Single-server-VictoriaMetrics.html">Single-server-VictoriaMetrics.md</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmagent.html">vmagent</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmalert.html">vmalert</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmauth.html">vmauth</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmbackup.html">vmbackup</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmctl.html">vmctl</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmrestore.html">vmrestore</a> </li> </ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/">VictoriaMetrics</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/" title="/"> <i class="fa fa-home"></i> </a> </li><li class="breadcrumb-item" aria-current="page">Cluster-VictoriaMetrics.md</li></ul> <a class="edit" href="https://github.com/Brensted/test1/edit/gh-pages/Cluster-VictoriaMetrics.md" title="Edit on GitHub" rel="noreferrer" target="_blank"> <i class="fa fa-edit"></i> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h1 id="cluster-version">Cluster version</h1> <p><img alt="Victoria Metrics" src="logo.png" /></p> <p>VictoriaMetrics is a fast, cost-effective and scalable time series database. It can be used as a long-term remote storage for Prometheus.</p> <p>It is recommended using <a href="https://github.com/VictoriaMetrics/VictoriaMetrics">single-node version</a> instead of cluster version for ingestion rates lower than a million of data points per second. Single-node version <a href="https://medium.com/@valyala/measuring-vertical-scalability-for-time-series-databases-in-google-cloud-92550d78d8ae">scales perfectly</a> with the number of CPU cores, RAM and available storage space. Single-node version is easier to configure and operate comparing to cluster version, so think twice before sticking to cluster version.</p> <p>Join <a href="http://slack.victoriametrics.com/">our Slack</a> or <a href="mailto:info@victoriametrics.com">contact us</a> with consulting and support questions.</p> <h2 id="prominent-features">Prominent features</h2> <ul> <li>Supports all the features of <a href="https://github.com/VictoriaMetrics/VictoriaMetrics">single-node version</a>.</li> <li>Performance and capacity scales horizontally. See <a href="#cluster-resizing-and-scalability">these docs for details</a>.</li> <li>Supports multiple independent namespaces for time series data (aka multi-tenancy). See <a href="#multitenancy">these docs for details</a>.</li> <li>Supports replication. See <a href="#replication-and-data-safety">these docs for details</a>.</li> </ul> <h2 id="architecture-overview">Architecture overview</h2> <p>VictoriaMetrics cluster consists of the following services:</p> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> - stores the data</li> <li><code class="language-plaintext highlighter-rouge notranslate">vminsert</code> - proxies the ingested data to <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> shards using consistent hashing</li> <li><code class="language-plaintext highlighter-rouge notranslate">vmselect</code> - performs incoming queries using the data from <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code></li> </ul> <p>Each service may scale independently and may run on the most suitable hardware. <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes don't know about each other, don't communicate with each other and don't share any data. This is <a href="https://en.wikipedia.org/wiki/Shared-nothing_architecture">shared nothing architecture</a>. It increases cluster availability, simplifies cluster maintenance and cluster scaling.</p> <p><img src="https://docs.google.com/drawings/d/e/2PACX-1vTvk2raU9kFgZ84oF-OKolrGwHaePhHRsZEcfQ1I_EC5AB_XPWwB392XshxPramLJ8E4bqptTnFn5LL/pub?w=1104&amp;h=746" /></p> <h2 id="multitenancy">Multitenancy</h2> <p>VictoriaMetrics cluster supports multiple isolated tenants (aka namespaces). Tenants are identified by <code class="language-plaintext highlighter-rouge notranslate">accountID</code> or <code class="language-plaintext highlighter-rouge notranslate">accountID:projectID</code>, which are put inside request urls. See <a href="#url-format">these docs</a> for details. Some facts about tenants in VictoriaMetrics:</p> <ul> <li> <p>Each <code class="language-plaintext highlighter-rouge notranslate">accountID</code> and <code class="language-plaintext highlighter-rouge notranslate">projectID</code> is identified by an arbitrary 32-bit integer in the range <code class="language-plaintext highlighter-rouge notranslate">[0 .. 2^32)</code>. If <code class="language-plaintext highlighter-rouge notranslate">projectID</code> is missing, then it is automatically assigned to <code class="language-plaintext highlighter-rouge notranslate">0</code>. It is expected that other information about tenants such as auth tokens, tenant names, limits, accounting, etc. is stored in a separate relational database. This database must be managed by a separate service sitting in front of VictoriaMetrics cluster such as <a href="https://victoriametrics.github.io/vmauth.html">vmauth</a>. <a href="mailto:info@victoriametrics.com">Contact us</a> if you need help with creating such a service.</p> </li> <li> <p>Tenants are automatically created when the first data point is written into the given tenant.</p> </li> <li> <p>Data for all the tenants is evenly spread among available <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes. This guarantees even load among <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes when different tenants have different amounts of data and different query load.</p> </li> <li> <p>VictoriaMetrics doesn't support querying multiple tenants in a single request.</p> </li> </ul> <h2 id="binaries">Binaries</h2> <p>Compiled binaries for cluster version are available in the <code class="language-plaintext highlighter-rouge notranslate">assets</code> section of <a href="https://github.com/VictoriaMetrics/VictoriaMetrics/releases">releases page</a>. See archives containing <code class="language-plaintext highlighter-rouge notranslate">cluster</code> word.</p> <p>Docker images for cluster version are available here:</p> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">vminsert</code> - https://hub.docker.com/r/victoriametrics/vminsert/tags</li> <li><code class="language-plaintext highlighter-rouge notranslate">vmselect</code> - https://hub.docker.com/r/victoriametrics/vmselect/tags</li> <li><code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> - https://hub.docker.com/r/victoriametrics/vmstorage/tags</li> </ul> <h2 id="building-from-sources">Building from sources</h2> <p>Source code for cluster version is available at <a href="https://github.com/VictoriaMetrics/VictoriaMetrics/tree/cluster">cluster branch</a>.</p> <h3 id="production-builds">Production builds</h3> <p>There is no need in installing Go on a host system since binaries are built inside <a href="https://hub.docker.com/_/golang">the official docker container for Go</a>. This makes reproducible builds. So <a href="https://docs.docker.com/install/">install docker</a> and run the following command:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>make vminsert-prod vmselect-prod vmstorage-prod
</code></pre>  </div></div> <p>Production binaries are built into statically linked binaries. They are put into <code class="language-plaintext highlighter-rouge notranslate">bin</code> folder with <code class="language-plaintext highlighter-rouge notranslate">-prod</code> suffixes:</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>$ make vminsert-prod vmselect-prod vmstorage-prod
$ ls -1 bin
vminsert-prod
vmselect-prod
vmstorage-prod
</code></pre>  </div></div> <h3 id="development-builds">Development Builds</h3> <ol> <li><a href="https://golang.org/doc/install">Install go</a>. The minimum supported version is Go 1.13.</li> <li>Run <code class="language-plaintext highlighter-rouge notranslate">make</code> from the repository root. It should build <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code>, <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> and <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> binaries and put them into the <code class="language-plaintext highlighter-rouge notranslate">bin</code> folder.</li> </ol> <h3 id="building-docker-images">Building docker images</h3> <p>Run <code class="language-plaintext highlighter-rouge notranslate">make package</code>. It will build the following docker images locally:</p> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">victoriametrics/vminsert:&lt;PKG_TAG&gt;</code></li> <li><code class="language-plaintext highlighter-rouge notranslate">victoriametrics/vmselect:&lt;PKG_TAG&gt;</code></li> <li><code class="language-plaintext highlighter-rouge notranslate">victoriametrics/vmstorage:&lt;PKG_TAG&gt;</code></li> </ul> <p><code class="language-plaintext highlighter-rouge notranslate">&lt;PKG_TAG&gt;</code> is auto-generated image tag, which depends on source code in the repository. The <code class="language-plaintext highlighter-rouge notranslate">&lt;PKG_TAG&gt;</code> may be manually set via <code class="language-plaintext highlighter-rouge notranslate">PKG_TAG=foobar make package</code>.</p> <p>By default images are built on top of <a href="https://hub.docker.com/_/scratch">alpine</a> image in order to improve debuggability. It is possible to build an image on top of any other base image by setting it via <code class="language-plaintext highlighter-rouge notranslate">&lt;ROOT_IMAGE&gt;</code> environment variable. For example, the following command builds images on top of <a href="https://hub.docker.com/_/scratch">scratch</a> image:</p> <div class="language-bash highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nv">ROOT_IMAGE</span><span class="o">=</span>scratch make package
</code></pre>  </div></div> <h2 id="operation">Operation</h2> <h2 id="cluster-setup">Cluster setup</h2> <p>A minimal cluster must contain the following nodes:</p> <ul> <li>a single <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node with <code class="language-plaintext highlighter-rouge notranslate">-retentionPeriod</code> and <code class="language-plaintext highlighter-rouge notranslate">-storageDataPath</code> flags</li> <li>a single <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> node with <code class="language-plaintext highlighter-rouge notranslate">-storageNode=&lt;vmstorage_host&gt;:8400</code></li> <li>a single <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> node with <code class="language-plaintext highlighter-rouge notranslate">-storageNode=&lt;vmstorage_host&gt;:8401</code></li> </ul> <p>It is recommended to run at least two nodes for each service for high availability purposes.</p> <p>An http load balancer such as <code class="language-plaintext highlighter-rouge notranslate">nginx</code> must be put in front of <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> and <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes:</p> <ul> <li>requests starting with <code class="language-plaintext highlighter-rouge notranslate">/insert</code> must be routed to port <code class="language-plaintext highlighter-rouge notranslate">8480</code> on <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> nodes.</li> <li>requests starting with <code class="language-plaintext highlighter-rouge notranslate">/select</code> must be routed to port <code class="language-plaintext highlighter-rouge notranslate">8481</code> on <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes.</li> </ul> <p>Ports may be altered by setting <code class="language-plaintext highlighter-rouge notranslate">-httpListenAddr</code> on the corresponding nodes.</p> <p>It is recommended setting up <a href="#monitoring">monitoring</a> for the cluster.</p> <h3 id="environment-variables">Environment variables</h3> <p>Each flag values can be set thru environment variables by following these rules:</p> <ul> <li>The <code class="language-plaintext highlighter-rouge notranslate">-envflag.enable</code> flag must be set</li> <li>Each <code class="language-plaintext highlighter-rouge notranslate">.</code> in flag names must be substituted by <code class="language-plaintext highlighter-rouge notranslate">_</code> (for example <code class="language-plaintext highlighter-rouge notranslate">-insert.maxQueueDuration &lt;duration&gt;</code> will translate to <code class="language-plaintext highlighter-rouge notranslate">insert_maxQueueDuration=&lt;duration&gt;</code>)</li> <li>For repeating flags, an alternative syntax can be used by joining the different values into one using <code class="language-plaintext highlighter-rouge notranslate">,</code> as separator (for example <code class="language-plaintext highlighter-rouge notranslate">-storageNode &lt;nodeA&gt; -storageNode &lt;nodeB&gt;</code> will translate to <code class="language-plaintext highlighter-rouge notranslate">storageNode=&lt;nodeA&gt;,&lt;nodeB&gt;</code>)</li> <li>It is possible setting prefix for environment vars with <code class="language-plaintext highlighter-rouge notranslate">-envflag.prefix</code>. For instance, if <code class="language-plaintext highlighter-rouge notranslate">-envflag.prefix=VM_</code>, then env vars must be prepended with <code class="language-plaintext highlighter-rouge notranslate">VM_</code></li> </ul> <h2 id="monitoring">Monitoring</h2> <p>All the cluster components expose various metrics in Prometheus-compatible format at <code class="language-plaintext highlighter-rouge notranslate">/metrics</code> page on the TCP port set in <code class="language-plaintext highlighter-rouge notranslate">-httpListenAddr</code> command-line flag. By default the following TCP ports are used:</p> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">vminsert</code> - 8480</li> <li><code class="language-plaintext highlighter-rouge notranslate">vmselect</code> - 8481</li> <li><code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> - 8482</li> </ul> <p>It is recommended setting up <a href="https://victoriametrics.github.io/vmagent.html">vmagent</a> or Prometheus to scrape <code class="language-plaintext highlighter-rouge notranslate">/metrics</code> pages from all the cluster components, so they can be monitored and analyzed with <a href="https://grafana.com/grafana/dashboards/11176">the official Grafana dashboard for VictoriaMetrics cluster</a> or <a href="https://grafana.com/grafana/dashboards/11831">an alternative dashboard for VictoriaMetrics cluster</a>.</p> <h2 id="url-format">URL format</h2> <ul> <li>URLs for data ingestion: <code class="language-plaintext highlighter-rouge notranslate">http://&lt;vminsert&gt;:8480/insert/&lt;accountID&gt;/&lt;suffix&gt;</code>, where: <ul> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;accountID&gt;</code> is an arbitrary 32-bit integer identifying namespace for data ingestion (aka tenant). It is possible to set it as <code class="language-plaintext highlighter-rouge notranslate">accountID:projectID</code>, where <code class="language-plaintext highlighter-rouge notranslate">projectID</code> is also arbitrary 32-bit integer. If <code class="language-plaintext highlighter-rouge notranslate">projectID</code> isn't set, then it equals to <code class="language-plaintext highlighter-rouge notranslate">0</code>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;suffix&gt;</code> may have the following values: <ul> <li><code class="language-plaintext highlighter-rouge notranslate">prometheus</code> and <code class="language-plaintext highlighter-rouge notranslate">prometheus/api/v1/write</code> - for inserting data with <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write">Prometheus remote write API</a></li> <li><code class="language-plaintext highlighter-rouge notranslate">influx/write</code> and <code class="language-plaintext highlighter-rouge notranslate">influx/api/v2/write</code> - for inserting data with <a href="https://docs.influxdata.com/influxdb/v1.7/write_protocols/line_protocol_tutorial/">Influx line protocol</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">opentsdb/api/put</code> - for accepting <a href="http://opentsdb.net/docs/build/html/api_http/put.html">OpenTSDB HTTP /api/put requests</a>. This handler is disabled by default. It is exposed on a distinct TCP address set via <code class="language-plaintext highlighter-rouge notranslate">-opentsdbHTTPListenAddr</code> command-line flag. See <a href="https://victoriametrics.github.io/Single-server-VictoriaMetrics.html#sending-opentsdb-data-via-http-apiput-requests">these docs</a> for details.</li> <li><code class="language-plaintext highlighter-rouge notranslate">prometheus/api/v1/import</code> - for importing data obtained via <code class="language-plaintext highlighter-rouge notranslate">api/v1/export</code> on <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> (see below).</li> <li><code class="language-plaintext highlighter-rouge notranslate">prometheus/api/v1/import/native</code> - for importing data obtained via <code class="language-plaintext highlighter-rouge notranslate">api/v1/export/native</code> on <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> (see below).</li> <li><code class="language-plaintext highlighter-rouge notranslate">prometheus/api/v1/import/csv</code> - for importing arbitrary CSV data. See <a href="https://victoriametrics.github.io/Single-server-VictoriaMetrics.html#how-to-import-csv-data">these docs</a> for details.</li> <li><code class="language-plaintext highlighter-rouge notranslate">prometheus/api/v1/import/prometheus</code> - for importing data in <a href="https://github.com/prometheus/docs/blob/master/content/docs/instrumenting/exposition_formats.md#text-based-format">Prometheus text exposition format</a> and in <a href="https://github.com/OpenObservability/OpenMetrics/blob/master/specification/OpenMetrics.md">OpenMetrics format</a>. See <a href="https://victoriametrics.github.io/Single-server-VictoriaMetrics.html#how-to-import-data-in-prometheus-exposition-format">these docs</a> for details.</li> </ul> </li> </ul> </li> <li>URLs for <a href="https://prometheus.io/docs/prometheus/latest/querying/api/">Prometheus querying API</a>: <code class="language-plaintext highlighter-rouge notranslate">http://&lt;vmselect&gt;:8481/select/&lt;accountID&gt;/prometheus/&lt;suffix&gt;</code>, where: <ul> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;accountID&gt;</code> is an arbitrary number identifying data namespace for the query (aka tenant)</li> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;suffix&gt;</code> may have the following values: <ul> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/query</code> - performs <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#instant-queries">PromQL instant query</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/query_range</code> - performs <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#range-queries">PromQL range query</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/series</code> - performs <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#finding-series-by-label-matchers">series query</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/labels</code> - returns a <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#getting-label-names">list of label names</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/label/&lt;label_name&gt;/values</code> - returns values for the given <code class="language-plaintext highlighter-rouge notranslate">&lt;label_name&gt;</code> according <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#querying-label-values">to API</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">federate</code> - returns <a href="https://prometheus.io/docs/prometheus/latest/federation/">federated metrics</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/export</code> - exports raw data in JSON line format. See <a href="https://medium.com/@valyala/analyzing-prometheus-data-with-external-tools-5f3e5e147639">this article</a> for details.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/export/native</code> - exports raw data in native binary format. It may be imported into another VictoriaMetrics via <code class="language-plaintext highlighter-rouge notranslate">api/v1/import/native</code> (see above).</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/export/csv</code> - exports data in CSV. It may be imported into another VictoriaMetrics via <code class="language-plaintext highlighter-rouge notranslate">api/v1/import/csv</code> (see above).</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/status/tsdb</code> - for time series stats. See <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#tsdb-stats">these docs</a> for details. VictoriaMetrics accepts optional <code class="language-plaintext highlighter-rouge notranslate">topN=N</code> and <code class="language-plaintext highlighter-rouge notranslate">date=YYYY-MM-DD</code> query args for this handler, where <code class="language-plaintext highlighter-rouge notranslate">N</code> is the number of top entries to return in the response and <code class="language-plaintext highlighter-rouge notranslate">YYYY-MM-DD</code> is the date for collecting the stats. By default the stats is collected for the current day.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/status/active_queries</code> - for currently executed active queries. Note that every <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> maintains an independent list of active queries, which is returned in the response.</li> <li><code class="language-plaintext highlighter-rouge notranslate">api/v1/status/top_queries</code> - for listing the most frequently executed queries and queries taking the most duration.</li> </ul> </li> </ul> </li> <li>URLs for <a href="https://graphite-api.readthedocs.io/en/latest/api.html#the-metrics-api">Graphite Metrics API</a>: <code class="language-plaintext highlighter-rouge notranslate">http://&lt;vmselect&gt;:8481/select/&lt;accountID&gt;/graphite/&lt;suffix&gt;</code>, where: <ul> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;accountID&gt;</code> is an arbitrary number identifying data namespace for query (aka tenant)</li> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;suffix&gt;</code> may have the following values: <ul> <li><code class="language-plaintext highlighter-rouge notranslate">render</code> - implements Graphite Render API. See <a href="https://graphite.readthedocs.io/en/stable/render_api.html">these docs</a>. This functionality is available in <a href="https://victoriametrics.com/enterprise.html">Enterprise package</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">metrics/find</code> - searches Graphite metrics. See <a href="https://graphite-api.readthedocs.io/en/latest/api.html#metrics-find">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">metrics/expand</code> - expands Graphite metrics. See <a href="https://graphite-api.readthedocs.io/en/latest/api.html#metrics-expand">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">metrics/index.json</code> - returns all the metric names. See <a href="https://graphite-api.readthedocs.io/en/latest/api.html#metrics-index-json">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags/tagSeries</code> - registers time series. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags/tagMultiSeries</code> - register multiple time series. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#adding-series-to-the-tagdb">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags</code> - returns tag names. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags/&lt;tag_name&gt;</code> - returns tag values for the given <code class="language-plaintext highlighter-rouge notranslate">&lt;tag_name&gt;</code>. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags/findSeries</code> - returns series matching the given <code class="language-plaintext highlighter-rouge notranslate">expr</code>. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#exploring-tags">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags/autoComplete/tags</code> - returns tags matching the given <code class="language-plaintext highlighter-rouge notranslate">tagPrefix</code> and/or <code class="language-plaintext highlighter-rouge notranslate">expr</code>. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags/autoComplete/values</code> - returns tag values matching the given <code class="language-plaintext highlighter-rouge notranslate">valuePrefix</code> and/or <code class="language-plaintext highlighter-rouge notranslate">expr</code>. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#auto-complete-support">these docs</a>.</li> <li><code class="language-plaintext highlighter-rouge notranslate">tags/delSeries</code> - deletes series matching the given <code class="language-plaintext highlighter-rouge notranslate">path</code>. See <a href="https://graphite.readthedocs.io/en/stable/tags.html#removing-series-from-the-tagdb">these docs</a>.</li> </ul> </li> </ul> </li> <li> <p>URL for query stats across all tenants: <code class="language-plaintext highlighter-rouge notranslate">http://&lt;vmselect&gt;:8481/api/v1/status/top_queries</code>. It lists with the most frequently executed queries and queries taking the most duration.</p> </li> <li> <p>URL for time series deletion: <code class="language-plaintext highlighter-rouge notranslate">http://&lt;vmselect&gt;:8481/delete/&lt;accountID&gt;/prometheus/api/v1/admin/tsdb/delete_series?match[]=&lt;timeseries_selector_for_delete&gt;</code>. Note that the <code class="language-plaintext highlighter-rouge notranslate">delete_series</code> handler should be used only in exceptional cases such as deletion of accidentally ingested incorrect time series. It shouldn't be used on a regular basis, since it carries non-zero overhead.</p> </li> <li><code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes provide the following HTTP endpoints on <code class="language-plaintext highlighter-rouge notranslate">8482</code> port: <ul> <li><code class="language-plaintext highlighter-rouge notranslate">/internal/force_merge</code> - initiate <a href="https://victoriametrics.github.io/#forced-merge">forced compactions</a> on the given <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node.</li> <li><code class="language-plaintext highlighter-rouge notranslate">/snapshot/create</code> - create <a href="https://medium.com/@valyala/how-victoriametrics-makes-instant-snapshots-for-multi-terabyte-time-series-data-e1f3fb0e0282">instant snapshot</a>, which can be used for backups in background. Snapshots are created in <code class="language-plaintext highlighter-rouge notranslate">&lt;storageDataPath&gt;/snapshots</code> folder, where <code class="language-plaintext highlighter-rouge notranslate">&lt;storageDataPath&gt;</code> is the corresponding command-line flag value.</li> <li><code class="language-plaintext highlighter-rouge notranslate">/snapshot/list</code> - list available snasphots.</li> <li><code class="language-plaintext highlighter-rouge notranslate">/snapshot/delete?snapshot=&lt;id&gt;</code> - delete the given snapshot.</li> <li><code class="language-plaintext highlighter-rouge notranslate">/snapshot/delete_all</code> - delete all the snapshots.</li> </ul> <p>Snapshots may be created independently on each <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node. There is no need in synchronizing snapshots' creation across <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes.</p> </li> </ul> <h2 id="cluster-resizing-and-scalability">Cluster resizing and scalability</h2> <p>Cluster performance and capacity scales with adding new nodes.</p> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">vminsert</code> and <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes are stateless and may be added / removed at any time. Do not forget updating the list of these nodes on http load balancer. Adding more <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> nodes scales data ingestion rate. See <a href="https://github.com/VictoriaMetrics/VictoriaMetrics/issues/175#issuecomment-536925841">this comment</a> about ingestion rate scalability. Adding more <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes scales select queries rate.</li> <li><code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes own the ingested data, so they cannot be removed without data loss. Adding more <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes scales cluster capacity.</li> </ul> <p>Steps to add <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node:</p> <ol> <li>Start new <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node with the same <code class="language-plaintext highlighter-rouge notranslate">-retentionPeriod</code> as existing nodes in the cluster.</li> <li>Gradually restart all the <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes with new <code class="language-plaintext highlighter-rouge notranslate">-storageNode</code> arg containing <code class="language-plaintext highlighter-rouge notranslate">&lt;new_vmstorage_host&gt;:8401</code>.</li> <li>Gradually restart all the <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> nodes with new <code class="language-plaintext highlighter-rouge notranslate">-storageNode</code> arg containing <code class="language-plaintext highlighter-rouge notranslate">&lt;new_vmstorage_host&gt;:8400</code>.</li> </ol> <h2 id="updating--reconfiguring-cluster-nodes">Updating / reconfiguring cluster nodes</h2> <p>All the node types - <code class="language-plaintext highlighter-rouge notranslate">vminsert</code>, <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> and <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> - may be updated via graceful shutdown. Send <code class="language-plaintext highlighter-rouge notranslate">SIGINT</code> signal to the corresponding process, wait until it finishes and then start new version with new configs.</p> <p>Cluster should remain in working state if at least a single node of each type remains available during the update process. See <a href="#cluster-availability">cluster availability</a> section for details.</p> <h2 id="cluster-availability">Cluster availability</h2> <ul> <li>HTTP load balancer must stop routing requests to unavailable <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> and <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes.</li> <li> <p>The cluster remains available if at least a single <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node exists:</p> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">vminsert</code> re-routes incoming data from unavailable <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes to healthy <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes</li> <li><code class="language-plaintext highlighter-rouge notranslate">vmselect</code> continues serving partial responses if at least a single <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node is available. If consistency over availability is preferred, then either pass <code class="language-plaintext highlighter-rouge notranslate">-search.denyPartialResponse</code> command-line flag to <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> or pass <code class="language-plaintext highlighter-rouge notranslate">deny_partial_response=1</code> query arg in requests to <code class="language-plaintext highlighter-rouge notranslate">vmselect</code>.</li> </ul> </li> </ul> <p>Data replication can be used for increasing storage durability. See <a href="#replication-and-data-safety">these docs</a> for details.</p> <h2 id="capacity-planning">Capacity planning</h2> <p>Each instance type - <code class="language-plaintext highlighter-rouge notranslate">vminsert</code>, <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> and <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> - can run on the most suitable hardware.</p> <h3 id="vminsert">vminsert</h3> <ul> <li>The recommended total number of vCPU cores for all the <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> instances can be calculated from the ingestion rate: <code class="language-plaintext highlighter-rouge notranslate">vCPUs = ingestion_rate / 150K</code>.</li> <li>The recommended number of vCPU cores per each <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> instance should equal to the number of <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> instances in the cluster.</li> <li>The amount of RAM per each <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> instance should be 1GB or more. RAM is used as a buffer for spikes in ingestion rate. The maximum amount of used RAM per <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> node can be tuned with <code class="language-plaintext highlighter-rouge notranslate">-memory.allowedPercent</code> or <code class="language-plaintext highlighter-rouge notranslate">-memory.allowedBytes</code> command-line flags. For instance, <code class="language-plaintext highlighter-rouge notranslate">-memory.allowedPercent=20</code> limits the maximum amount of used RAM to 20% of the available RAM on the host system.</li> <li>Sometimes <code class="language-plaintext highlighter-rouge notranslate">-rpc.disableCompression</code> command-line flag on <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> instances could increase ingestion capacity at the cost of higher network bandwidth usage between <code class="language-plaintext highlighter-rouge notranslate">vminsert</code> and <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code>.</li> </ul> <h3 id="vmstorage">vmstorage</h3> <ul> <li>The recommended total number of vCPU cores for all the <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> instances can be calculated from the ingestion rate: <code class="language-plaintext highlighter-rouge notranslate">vCPUs = ingestion_rate / 150K</code>.</li> <li>The recommended total amount of RAM for all the <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> instances can be calculated from the number of active time series: <code class="language-plaintext highlighter-rouge notranslate">RAM = 2 * active_time_series * 1KB</code>. Time series is active if it received at least a single data point during the last hour or if it has been queried during the last hour. The required RAM per each <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> should be multiplied by <code class="language-plaintext highlighter-rouge notranslate">-replicationFactor</code> if <a href="#replication-and-data-safety">replication</a> is enabled. Additional RAM can be required for query processing. Calculated RAM requrements may differ from actual RAM requirements due to various factors: <ul> <li>The average number of labels per time series. More labels require more RAM.</li> <li>The average length of label names and label values. Longer labels require more RAM.</li> <li>The type of queries. Heavy queries that scan big number of time series over long time ranges require more RAM.</li> </ul> </li> <li>The recommended total amount of storage space for all the <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> instances can be calculated from the ingestion rate and retention: <code class="language-plaintext highlighter-rouge notranslate">storage_space = ingestion_rate * retention_seconds</code>.</li> </ul> <h3 id="vmselect">vmselect</h3> <p>The recommended hardware for <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> instances highly depends on the type of queries. Lightweight queries over small number of time series usually require small number of vCPU cores and small amount of RAM on <code class="language-plaintext highlighter-rouge notranslate">vmselect</code>, while heavy queries over big number of time series (&gt;10K) usually require bigger number of vCPU cores and bigger amounts of RAM.</p> <p>In general it is recommended increasing the number of vCPU cores and RAM per <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> node for higher query performance, while adding new <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes only when old nodes are overloaded with incoming query stream.</p> <h2 id="high-availability">High availability</h2> <p>It is recommended to run all the components for a single cluster in the same subnetwork with high bandwidth, low latency and low error rates. This improves cluster performance and availability. It isn't recommended spreading components for a single cluster across multiple availability zones, since cross-AZ network usually has lower bandwidth, higher latency and higher error rates comparing the network inside AZ.</p> <p>If you need multi-AZ setup, then it is recommended running independed clusters in each AZ and setting up <a href="https://victoriametrics.github.io/vmagent.html">vmagent</a> in front of these clusters, so it could replicate incoming data into all the cluster. Then <a href="https://github.com/jacksontj/promxy">promxy</a> could be used for querying the data from multiple clusters.</p> <h2 id="helm">Helm</h2> <p>Helm chart simplifies managing cluster version of VictoriaMetrics in Kubernetes. It is available in the <a href="https://github.com/VictoriaMetrics/helm-charts">helm-charts</a> repository.</p> <h2 id="kubernetes-operator">Kubernetes operator</h2> <p><a href="https://github.com/VictoriaMetrics/operator">K8s operator</a> simplifies managing VictoriaMetrics components in Kubernetes.</p> <h2 id="replication-and-data-safety">Replication and data safety</h2> <p>By default VictoriaMetrics offloads replication to the underlying storage pointed by <code class="language-plaintext highlighter-rouge notranslate">-storageDataPath</code>.</p> <p>The replication can be enabled by passing <code class="language-plaintext highlighter-rouge notranslate">-replicationFactor=N</code> command-line flag to <code class="language-plaintext highlighter-rouge notranslate">vminsert</code>. This guarantees that all the data remains available for querying if up to <code class="language-plaintext highlighter-rouge notranslate">N-1</code> <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes are unavailable. The cluster must contain at least <code class="language-plaintext highlighter-rouge notranslate">2*N-1</code> <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes, where <code class="language-plaintext highlighter-rouge notranslate">N</code> is replication factor, in order to maintain the given replication factor for newly ingested data when <code class="language-plaintext highlighter-rouge notranslate">N-1</code> of storage nodes are lost. For example, when <code class="language-plaintext highlighter-rouge notranslate">-replicationFactor=3</code> is passed to <code class="language-plaintext highlighter-rouge notranslate">vminsert</code>, then it replicates all the ingested data to 3 distinct <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes, so up to 2 <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes can be lost without data loss. The minimum number of <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes should be equal to <code class="language-plaintext highlighter-rouge notranslate">2*3-1 = 5</code>, so when 2 <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes are lost, the remaining 3 <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes could provide the <code class="language-plaintext highlighter-rouge notranslate">-replicationFactor=3</code> for newly ingested data.</p> <p>When the replication is enabled, <code class="language-plaintext highlighter-rouge notranslate">-replicationFactor=N</code> and <code class="language-plaintext highlighter-rouge notranslate">-dedup.minScrapeInterval=1ms</code> command-line flag must be passed to <code class="language-plaintext highlighter-rouge notranslate">vmselect</code> nodes. The <code class="language-plaintext highlighter-rouge notranslate">-replicationFactor=N</code> improves query performance when a part of vmstorage nodes respond slowly and/or temporarily unavailable. The <code class="language-plaintext highlighter-rouge notranslate">-dedup.minScrapeInterval=1ms</code> de-duplicates replicated data during queries. It is OK if <code class="language-plaintext highlighter-rouge notranslate">-dedup.minScrapeInterval</code> exceeds 1ms when <a href="https://victoriametrics.github.io/Single-server-VictoriaMetrics.html#deduplication">deduplication</a> is used additionally to replication.</p> <p>Note that <a href="https://medium.com/@valyala/speeding-up-backups-for-big-time-series-databases-533c1a927883">replication doesn't save from disaster</a>, so it is recommended performing regular backups. See <a href="#backups">these docs</a> for details.</p> <p>Note that the replication increases resource usage - CPU, RAM, disk space, network bandwidth - by up to <code class="language-plaintext highlighter-rouge notranslate">-replicationFactor</code> times. So it may be worth offloading the replication to underlying storage pointed by <code class="language-plaintext highlighter-rouge notranslate">-storageDataPath</code> such as <a href="https://cloud.google.com/compute/docs/disks/#pdspecs">Google Compute Engine persistent disk</a>, which is protected from data loss and data corruption. It also provide consistently high performance and <a href="https://cloud.google.com/compute/docs/disks/add-persistent-disk">may be resized</a> without downtime. HDD-based persistent disks should be enough for the majority of use cases.</p> <p>It is recommended using durable replicated persistent volumes in Kubernetes.</p> <h2 id="backups">Backups</h2> <p>It is recommended performing periodical backups from <a href="https://medium.com/@valyala/how-victoriametrics-makes-instant-snapshots-for-multi-terabyte-time-series-data-e1f3fb0e0282">instant snapshots</a> for protecting from user errors such as accidental data deletion.</p> <p>The following steps must be performed for each <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node for creating a backup:</p> <ol> <li>Create an instant snapshot by navigating to <code class="language-plaintext highlighter-rouge notranslate">/snapshot/create</code> HTTP handler. It will create snapshot and return its name.</li> <li>Archive the created snapshot from <code class="language-plaintext highlighter-rouge notranslate">&lt;-storageDataPath&gt;/snapshots/&lt;snapshot_name&gt;</code> folder using <a href="https://victoriametrics.github.io/vbackup.html">vmbackup</a>. The archival process doesn't interfere with <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> work, so it may be performed at any suitable time.</li> <li>Delete unused snapshots via <code class="language-plaintext highlighter-rouge notranslate">/snapshot/delete?snapshot=&lt;snapshot_name&gt;</code> or <code class="language-plaintext highlighter-rouge notranslate">/snapshot/delete_all</code> in order to free up occupied storage space.</li> </ol> <p>There is no need in synchronizing backups among all the <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> nodes.</p> <p>Restoring from backup:</p> <ol> <li>Stop <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node with <code class="language-plaintext highlighter-rouge notranslate">kill -INT</code>.</li> <li>Restore data from backup using <a href="https://victoriametrics.github.io/vmrestore.html">vmrestore</a> into <code class="language-plaintext highlighter-rouge notranslate">-storageDataPath</code> directory.</li> <li>Start <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code> node.</li> </ol> <h2 id="profiling">Profiling</h2> <p>All the cluster components provide the following handlers for <a href="https://blog.golang.org/profiling-go-programs">profiling</a>:</p> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">http://vminsert:8480/debug/pprof/heap</code> for memory profile and <code class="language-plaintext highlighter-rouge notranslate">http://vminsert:8480/debug/pprof/profile</code> for CPU profile</li> <li><code class="language-plaintext highlighter-rouge notranslate">http://vmselect:8481/debug/pprof/heap</code> for memory profile and <code class="language-plaintext highlighter-rouge notranslate">http://vmselect:8481/debug/pprof/profile</code> for CPU profile</li> <li><code class="language-plaintext highlighter-rouge notranslate">http://vmstorage:8482/debug/pprof/heap</code> for memory profile and <code class="language-plaintext highlighter-rouge notranslate">http://vmstorage:8482/debug/pprof/profile</code> for CPU profile</li> </ul> <p>Example command for collecting cpu profile from <code class="language-plaintext highlighter-rouge notranslate">vmstorage</code>:</p> <div class="language-bash highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> http://vmstorage:8482/debug/pprof/profile <span class="o">&gt;</span> cpu.pprof
</code></pre>  </div></div> <p>Example command for collecting memory profile from <code class="language-plaintext highlighter-rouge notranslate">vminsert</code>:</p> <div class="language-bash highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-s</span> http://vminsert:8480/debug/pprof/heap <span class="o">&gt;</span> mem.pprof
</code></pre>  </div></div> <h2 id="community-and-contributions">Community and contributions</h2> <p>We are open to third-party pull requests provided they follow <a href="https://en.wikipedia.org/wiki/KISS_principle">KISS design principle</a>:</p> <ul> <li>Prefer simple code and architecture.</li> <li>Avoid complex abstractions.</li> <li>Avoid magic code and fancy algorithms.</li> <li>Avoid <a href="https://medium.com/@valyala/stripping-dependency-bloat-in-victoriametrics-docker-image-983fb5912b0d">big external dependencies</a>.</li> <li>Minimize the number of moving parts in the distributed system.</li> <li>Avoid automated decisions, which may hurt cluster availability, consistency or performance.</li> </ul> <p>Adhering <code class="language-plaintext highlighter-rouge notranslate">KISS</code> principle simplifies the resulting code and architecture, so it can be reviewed, understood and verified by many people.</p> <p>Due to <code class="language-plaintext highlighter-rouge notranslate">KISS</code> cluster version of VictoriaMetrics has no the following "features" popular in distributed computing world:</p> <ul> <li>Fragile gossip protocols. See <a href="https://github.com/improbable-eng/thanos/blob/030bc345c12c446962225221795f4973848caab5/docs/proposals/completed/201809_gossip-removal.md">failed attempt in Thanos</a>.</li> <li>Hard-to-understand-and-implement-properly <a href="https://www.quora.com/In-distributed-systems-what-is-a-simple-explanation-of-the-Paxos-algorithm">Paxos protocols</a>.</li> <li>Complex replication schemes, which may go nuts in unforesseen edge cases. See <a href="#replication-and-data-safety">replication docs</a> for details.</li> <li>Automatic data reshuffling between storage nodes, which may hurt cluster performance and availability.</li> <li>Automatic cluster resizing, which may cost you a lot of money if improperly configured.</li> <li>Automatic discovering and addition of new nodes in the cluster, which may mix data between dev and prod clusters :)</li> <li>Automatic leader election, which may result in split brain disaster on network errors.</li> </ul> <h2 id="reporting-bugs">Reporting bugs</h2> <p>Report bugs and propose new features <a href="https://github.com/VictoriaMetrics/VictoriaMetrics/issues">here</a>.</p> <h2 id="victoria-metrics-logo">Victoria Metrics Logo</h2> <p><a href="VM_logo.zip">Zip</a> contains three folders with different image orientation (main color and inverted version).</p> <p>Files included in each folder:</p> <ul> <li>2 JPEG Preview files</li> <li>2 PNG Preview files with transparent background</li> <li>2 EPS Adobe Illustrator EPS10 files</li> </ul> <h3 id="logo-usage-guidelines">Logo Usage Guidelines</h3> <h4 id="font-used">Font used:</h4> <ul> <li>Lato Black</li> <li>Lato Regular</li> </ul> <h4 id="color-palette">Color Palette:</h4> <ul> <li>HEX <a href="https://www.color-hex.com/color/110f0f">#110f0f</a></li> <li>HEX <a href="https://www.color-hex.com/color/ffffff">#ffffff</a></li> </ul> <h3 id="we-kindly-ask">We kindly ask:</h3> <ul> <li>Please don't use any other font instead of suggested.</li> <li>There should be sufficient clear space around the logo.</li> <li>Do not change spacing, alignment, or relative locations of the design elements.</li> <li>Do not change the proportions of any of the design elements or the design itself. You may resize as needed but must retain all proportions.</li> </ul> </div> </div> <div class="navigation-bottom d-flex flex-justify-between py-3" role="navigation" aria-label="footer navigation"> <div class="prev"></div> <div class="next"><a href="/ExtendedPromQL.html" class="btn" title="MetricsQL" accesskey="n" rel="next"> Next <i class="fa fa-arrow-circle-right"></i> </a></div> </div><hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2021,</span> <a class="text-gray" href="https://github.com/Brensted" rel="noreferrer" target="_blank">Brensted</a> Revision <a class="text-gray" href="https://github.com/Brensted/test1/commit/156072bda364bc719a657b8c14a5f5ba4c757132" title="156072bda364bc719a657b8c14a5f5ba4c757132" rel="noreferrer" target="_blank">156072b</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="rundocs/jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> VictoriaMetrics </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/Brensted/test1" title="Stars: 0"> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="https://github.com/Brensted/test1/issues" title="Open issues: 0"> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/Brensted/test1/zipball/gh-pages" title="Size: 0 Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/" title="VictoriaMetrics">Software</a> is under the terms of <a href="https://github.com/Brensted/test1">The Unlicense</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>