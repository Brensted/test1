<!DOCTYPE html> <html lang="en" dir="auto"> <head><meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="vmrestore vmrestore restores data from backups created by vmbackup. VictoriaMetrics v1.29.0 and newer versions must be used for working with the re..."> <meta name="revised" content="156072bda364bc719a657b8c14a5f5ba4c757132"> <meta name="author" content="Brensted"> <meta name="generator" content="rundocs/jekyll-rtd-theme v2.0.10"><meta name="theme-color" content="#2980b9"> <title>vmrestore · VictoriaMetrics</title> <meta name="twitter:title" content="vmrestore · VictoriaMetrics"> <meta name="twitter:description" content="vmrestore vmrestore restores data from backups created by vmbackup. VictoriaMetrics v1.29.0 and newer versions must be used for working with the re..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@Brensted"> <meta name="twitter:url" content="http://localhost:4000/vmrestore.html"> <meta name="twitter:creator" content="@rundocs/jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="vmrestore · VictoriaMetrics"> <meta property="og:description" content="vmrestore vmrestore restores data from backups created by vmbackup. VictoriaMetrics v1.29.0 and newer versions must be used for working with the re..."> <meta property="og:locale" content="en"> <meta property="og:url" content="http://localhost:4000/vmrestore.html"> <meta property="og:type" content="article"> <meta property="article:author" content="Brensted"> <meta property="article:published_time" content="2021-02-25T10:08:59+02:00"> <meta property="article:modified_time" content="2021-02-25T10:28:47+02:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "http://localhost:4000/vmrestore.html" }, "headline": "vmrestore · VictoriaMetrics", "image": [], "author": { "@type": "Person", "name": "Brensted" }, "datePublished": "2021-02-25T10:08:59+02:00", "dateModified": "2021-02-25T10:28:47+02:00", "publisher": { "@type": "User", "name": "Brensted", "logo": { "@type": "ImageObject", "url": "https://avatars.githubusercontent.com/u/75306281?v=4" } }, "description": "vmrestore vmrestore restores data from backups created by vmbackup. VictoriaMetrics v1.29.0 and newer versions must be used for working with the re..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="prev" href="http://localhost:4000/vmctl.html"><link rel="canonical" href="http://localhost:4000/vmrestore.html"><link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg"><link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96"><link rel="mask-icon" href="/assets/images/favicon.svg" color="#2980b9"><link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css"><script> window.ui = { title: "VictoriaMetrics", baseurl: "", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container"><div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/" title="VictoriaMetrics"> <i class="fa fa-home"></i> VictoriaMetrics </a> </div> <span class="version"></span> <form class="search pt-2" action="/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Cluster-VictoriaMetrics.html">Cluster version</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/ExtendedPromQL.html">MetricsQL</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Home.html">Docs</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Quick-Start.html">Quick Start</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Release-Guide.html">Release-Guide.md</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/SampleSizeCalculations.html">Sample size calculations</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/Single-server-VictoriaMetrics.html">Single-server-VictoriaMetrics.md</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmagent.html">vmagent</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmalert.html">vmalert</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmauth.html">vmauth</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmbackup.html">vmbackup</a> </li> <li class="toc level-1 " data-sort="" data-level="1"> <a class="d-flex flex-items-baseline " href="/vmctl.html">vmctl</a> </li> <li class="toc level-1 current" data-sort="" data-level="1"> <a class="d-flex flex-items-baseline current" href="/vmrestore.html">vmrestore</a> </li> </ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/">VictoriaMetrics</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/" title="/"> <i class="fa fa-home"></i> </a> </li><li class="breadcrumb-item" aria-current="page">vmrestore.md</li></ul> <a class="edit" href="https://github.com/Brensted/test1/edit/gh-pages/vmrestore.md" title="Edit on GitHub" rel="noreferrer" target="_blank"> <i class="fa fa-edit"></i> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h2 id="vmrestore">vmrestore</h2> <p><code class="language-plaintext highlighter-rouge notranslate">vmrestore</code> restores data from backups created by <a href="https://victoriametrics.github.io/vbackup.html">vmbackup</a>. VictoriaMetrics <code class="language-plaintext highlighter-rouge notranslate">v1.29.0</code> and newer versions must be used for working with the restored data.</p> <p>Restore process can be interrupted at any time. It is automatically resumed from the interruption point when restarting <code class="language-plaintext highlighter-rouge notranslate">vmrestore</code> with the same args.</p> <h2 id="usage">Usage</h2> <p>VictoriaMetrics must be stopped during the restore process.</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>vmrestore -src=gcs://&lt;bucket&gt;/&lt;path/to/backup&gt; -storageDataPath=&lt;local/path/to/restore&gt;

</code></pre>  </div></div> <ul> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;bucket&gt;</code> is <a href="https://cloud.google.com/storage/docs/creating-buckets">GCS bucket</a> name.</li> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;path/to/backup&gt;</code> is the path to backup made with <a href="https://victoriametrics.github.io/vbackup.html">vmbackup</a> on GCS bucket.</li> <li><code class="language-plaintext highlighter-rouge notranslate">&lt;local/path/to/restore&gt;</code> is the path to folder where data will be restored. This folder must be passed to VictoriaMetrics in <code class="language-plaintext highlighter-rouge notranslate">-storageDataPath</code> command-line flag after the restore process is complete.</li> </ul> <p>The original <code class="language-plaintext highlighter-rouge notranslate">-storageDataPath</code> directory may contain old files. They will be substituted by the files from backup, i.e. the end result would be similar to <a href="https://askubuntu.com/questions/476041/how-do-i-make-rsync-delete-files-that-have-been-deleted-from-the-source-folder">rsync –delete</a>.</p> <h2 id="troubleshooting">Troubleshooting</h2> <ul> <li>If <code class="language-plaintext highlighter-rouge notranslate">vmrestore</code> eats all the network bandwidth, then set <code class="language-plaintext highlighter-rouge notranslate">-maxBytesPerSecond</code> to the desired value.</li> <li>If <code class="language-plaintext highlighter-rouge notranslate">vmrestore</code> has been interrupted due to temporary error, then just restart it with the same args. It will resume the restore process.</li> </ul> <h2 id="advanced-usage">Advanced usage</h2> <ul> <li> <p>Obtaining credentials from a file.</p> <p>Add flag <code class="language-plaintext highlighter-rouge notranslate">-credsFilePath=/etc/credentials</code> with following content:</p> <p>for s3 (aws, minio or other s3 compatible storages):</p> <div class="language-bash highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>   <span class="o">[</span>default]
   <span class="nv">aws_access_key_id</span><span class="o">=</span>theaccesskey
   <span class="nv">aws_secret_access_key</span><span class="o">=</span>thesecretaccesskeyvalue
</code></pre>  </div> </div> <p>for gce cloud storage:</p> <div class="language-json highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
         </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service_account"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"project-id"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"private_key_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key-id"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"private_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-----BEGIN PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">private-key</span><span class="se">\n</span><span class="s2">-----END PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"client_email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"service-account-email"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"client_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"client-id"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"auth_uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://accounts.google.com/o/oauth2/auth"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"token_uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://accounts.google.com/o/oauth2/token"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"auth_provider_x509_cert_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.googleapis.com/oauth2/v1/certs"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"client_x509_cert_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://www.googleapis.com/robot/v1/metadata/x509/service-account-email"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>  </div> </div> </li> <li>Usage with s3 custom url endpoint. It is possible to use <code class="language-plaintext highlighter-rouge notranslate">vmrestore</code> with s3 api compatible storages, like minio, cloudian and other. You have to add custom url endpoint with a flag: <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code># for minio:
-customS3Endpoint=http://localhost:9000

# for aws gov region
-customS3Endpoint=https://s3-fips.us-gov-west-1.amazonaws.com
</code></pre>  </div> </div> </li> <li>Run <code class="language-plaintext highlighter-rouge notranslate">vmrestore -help</code> in order to see all the available options:</li> </ul> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code>  -concurrency int
    	The number of concurrent workers. Higher concurrency may reduce restore duration (default 10)
  -configFilePath string
    	Path to file with S3 configs. Configs are loaded from default location if not set.
    	See https://docs.aws.amazon.com/general/latest/gr/aws-security-credentials.html
  -configProfile string
    	Profile name for S3 configs. If no set, the value of the environment variable will be loaded (AWS_PROFILE or AWS_DEFAULT_PROFILE), or if both not set, DefaultSharedConfigProfile is used
  -credsFilePath string
    	Path to file with GCS or S3 credentials. Credentials are loaded from default locations if not set.
    	See https://cloud.google.com/iam/docs/creating-managing-service-account-keys and https://docs.aws.amazon.com/general/latest/gr/aws-security-credentials.html
  -customS3Endpoint string
    	Custom S3 endpoint for use with S3-compatible storages (e.g. MinIO). S3 is used if not set
  -envflag.enable
    	Whether to enable reading flags from environment variables additionally to command line. Command line flag values have priority over values from environment vars. Flags are read only from command line if this flag isn't set
  -envflag.prefix string
    	Prefix for environment variables if -envflag.enable is set
  -fs.disableMmap
    	Whether to use pread() instead of mmap() for reading data files. By default mmap() is used for 64-bit arches and pread() is used for 32-bit arches, since they cannot read data files bigger than 2^32 bytes in memory. mmap() is usually faster for reading small data chunks than pread()
  -loggerErrorsPerSecondLimit int
    	Per-second limit on the number of ERROR messages. If more than the given number of errors are emitted per second, then the remaining errors are suppressed. Zero value disables the rate limit (default 10)
  -loggerFormat string
    	Format for logs. Possible values: default, json (default "default")
  -loggerLevel string
    	Minimum level of errors to log. Possible values: INFO, WARN, ERROR, FATAL, PANIC (default "INFO")
  -loggerOutput string
    	Output for the logs. Supported values: stderr, stdout (default "stderr")
  -maxBytesPerSecond value
    	The maximum download speed. There is no limit if it is set to 0
    	Supports the following optional suffixes for values: KB, MB, GB, KiB, MiB, GiB (default 0)
  -memory.allowedBytes value
    	Allowed size of system memory VictoriaMetrics caches may occupy. This option overrides -memory.allowedPercent if set to non-zero value. Too low value may increase cache miss rate, which usually results in higher CPU and disk IO usage. Too high value may evict too much data from OS page cache, which will result in higher disk IO usage
    	Supports the following optional suffixes for values: KB, MB, GB, KiB, MiB, GiB (default 0)
  -memory.allowedPercent float
    	Allowed percent of system memory VictoriaMetrics caches may occupy. See also -memory.allowedBytes. Too low value may increase cache miss rate, which usually results in higher CPU and disk IO usage. Too high value may evict too much data from OS page cache, which will result in higher disk IO usage (default 60)
  -skipBackupCompleteCheck
    	Whether to skip checking for 'backup complete' file in -src. This may be useful for restoring from old backups, which were created without 'backup complete' file
  -src string
    	Source path with backup on the remote storage. Example: gcs://bucket/path/to/backup/dir, s3://bucket/path/to/backup/dir or fs:///path/to/local/backup/dir
  -storageDataPath string
    	Destination path where backup must be restored. VictoriaMetrics must be stopped when restoring from backup. -storageDataPath dir can be non-empty. In this case the contents of -storageDataPath dir is synchronized with -src contents, i.e. it works like 'rsync --delete' (default "victoria-metrics-data")
  -version
    	Show VictoriaMetrics version
</code></pre>  </div></div> <h2 id="how-to-build-from-sources">How to build from sources</h2> <p>It is recommended using <a href="https://github.com/VictoriaMetrics/VictoriaMetrics/releases">binary releases</a> - see <code class="language-plaintext highlighter-rouge notranslate">vmutils-*</code> archives there.</p> <h3 id="development-build">Development build</h3> <ol> <li><a href="https://golang.org/doc/install">Install Go</a>. The minimum supported version is Go 1.13.</li> <li>Run <code class="language-plaintext highlighter-rouge notranslate">make vmrestore</code> from the root folder of the repository. It builds <code class="language-plaintext highlighter-rouge notranslate">vmrestore</code> binary and puts it into the <code class="language-plaintext highlighter-rouge notranslate">bin</code> folder.</li> </ol> <h3 id="production-build">Production build</h3> <ol> <li><a href="https://docs.docker.com/install/">Install docker</a>.</li> <li>Run <code class="language-plaintext highlighter-rouge notranslate">make vmrestore-prod</code> from the root folder of the repository. It builds <code class="language-plaintext highlighter-rouge notranslate">vmrestore-prod</code> binary and puts it into the <code class="language-plaintext highlighter-rouge notranslate">bin</code> folder.</li> </ol> <h3 id="building-docker-images">Building docker images</h3> <p>Run <code class="language-plaintext highlighter-rouge notranslate">make package-vmrestore</code>. It builds <code class="language-plaintext highlighter-rouge notranslate">victoriametrics/vmrestore:&lt;PKG_TAG&gt;</code> docker image locally. <code class="language-plaintext highlighter-rouge notranslate">&lt;PKG_TAG&gt;</code> is auto-generated image tag, which depends on source code in the repository. The <code class="language-plaintext highlighter-rouge notranslate">&lt;PKG_TAG&gt;</code> may be manually set via <code class="language-plaintext highlighter-rouge notranslate">PKG_TAG=foobar make package-vmrestore</code>.</p> <p>The base docker image is <a href="https://hub.docker.com/_/alpine">alpine</a> but it is possible to use any other base image by setting it via <code class="language-plaintext highlighter-rouge notranslate">&lt;ROOT_IMAGE&gt;</code> environment variable. For example, the following command builds the image on top of <a href="https://hub.docker.com/_/scratch">scratch</a> image:</p> <div class="language-bash highlighter-rouge notranslate"><div class="highlight"><pre class="highlight"><code><span class="nv">ROOT_IMAGE</span><span class="o">=</span>scratch make package-vmrestore
</code></pre>  </div></div> </div> </div> <div class="navigation-bottom d-flex flex-justify-between py-3" role="navigation" aria-label="footer navigation"> <div class="prev"><a href="/vmctl.html" class="btn" title="vmctl" accesskey="p" rel="prev"> <i class="fa fa-arrow-circle-left"></i> Previous </a></div> <div class="next"></div> </div><hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2021,</span> <a class="text-gray" href="https://github.com/Brensted" rel="noreferrer" target="_blank">Brensted</a> Revision <a class="text-gray" href="https://github.com/Brensted/test1/commit/156072bda364bc719a657b8c14a5f5ba4c757132" title="156072bda364bc719a657b8c14a5f5ba4c757132" rel="noreferrer" target="_blank">156072b</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="rundocs/jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> VictoriaMetrics </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/Brensted/test1" title="Stars: 0"> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="https://github.com/Brensted/test1/issues" title="Open issues: 0"> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/Brensted/test1/zipball/gh-pages" title="Size: 0 Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/" title="VictoriaMetrics">Software</a> is under the terms of <a href="https://github.com/Brensted/test1">The Unlicense</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>